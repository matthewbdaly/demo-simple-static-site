<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="fb:app_id" content="1503502813234429"/>
        <link rel="stylesheet" type="text/css" href="/static/bower_components/bootstrap-sass/dist/css/bootstrap.min.css" media="all" />
        <link rel="stylesheet" type="text/css" href="/static/bower_components/flat-ui/dist/css/flat-ui.min.css" media="all" />
        <link rel="stylesheet" type="text/css" href="/static/bower_components/highlightjs/styles/zenburn.css" media="all" />
        <link rel="alternate" type="application/rss+xml" title="A Series of Quite Extraordinary Events - feed" href="/index.xml" />
        <title>A Series of Quite Extraordinary Events - Django Blog Tutorial - the Next Generation - Part 8</title>
    </head>
    <body>
        <header>
            <div class="container">
                <div class="page-header">
                    <h1>A Series of Quite Extraordinary Events</h1>
                    <h2>Being the blog of Matthew Daly Esquire</h2>
                    <nav>
                        <a href="/">Home</a> | <a href="/archive.html">Archives</a> | <a href="/about.html">About</a> | <a href="/rss.xml">RSS</a>
                    </nav>
                </div>
            </div>
        </header>

        <div class="container">
            <article class="post">
    
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
    
  <div class="title">
    <h1><a href="/posts/2014-08-31-django-blog-tutorial-the-next-generation-part-8.html">Django Blog Tutorial - the Next Generation - Part 8</a></h1>
  </div>
  <section>
    <p>Hello again! In our final instalment, we&#39;ll wrap up our blog by:</p>
<ul>
<li>Implementing a sitemap</li>
<li>Optimising and tidying up the site</li>
<li>Creating a Fabric task for easier deployment</li>
</ul>
<p>I&#39;ll also cover development tools and practices that can make using Django easier. But first there&#39;s a few housekeeping tasks that need doing...</p>
<p>Don&#39;t forget to activate your virtualenv - you should know how to do this off by heart by now!</p>
<h1 id="upgrading-django">Upgrading Django</h1>
<p>At the time of writing, Django 1.7 is due any day now, but it&#39;s not out yet so I won&#39;t cover it. The biggest change is the addition of a built-in migration system, but switching from South to this is well-documented. When Django 1.7 comes out, it shouldn&#39;t be difficult to upgrade to it - because we have good test coverage, we shouldn&#39;t have much trouble catching errors.</p>
<p>However, Django 1.6.6 was recently released, and we need to upgrade to it. Just enter the following command to upgrade:</p>
<pre><code class="lang-bash">pip install Django --upgrade</code></pre>
<p>Then add it to your <code>requirements.txt</code>:</p>
<pre><code class="lang-bash">pip freeze &gt; requirements.txt</code></pre>
<p>Then commit your changes:</p>
<pre><code class="lang-bash">git add requirements.txt
git commit -m <span class="string">'Upgraded Django version'</span></code></pre>
<h1 id="implementing-a-sitemap">Implementing a sitemap</h1>
<p>Creating a sitemap for your blog is a good idea - it can be submitted to search engines, so that they can easily find your content. With Django, it&#39;s pretty straightforward too.</p>
<p>First, let&#39;s create a test for our sitemap. Add the following code at the end of <code>tests.py</code>:</p>
<p>``` python blogengine/tests.py
class SitemapTest(BaseAcceptanceTest):
    def test_sitemap(self):</p>
<pre><code>    # <span class="operator"><span class="keyword">Create</span> a post
    post = PostFactory()

    # <span class="keyword">Create</span> a flat page
    page = FlatPageFactory()

    # <span class="keyword">Get</span> sitemap
    response = self.client.<span class="keyword">get</span>(<span class="string">'/sitemap.xml'</span>)
    self.assertEquals(response.status_code, <span class="number">200</span>)

    # <span class="keyword">Check</span> post <span class="keyword">is</span> present <span class="keyword">in</span> sitemap
    self.assertTrue(<span class="string">'my-first-post'</span> <span class="keyword">in</span> response.content)

    # <span class="keyword">Check</span> page <span class="keyword">is</span> present <span class="keyword">in</span> sitemap
    self.assertTrue(<span class="string">'/about/'</span> <span class="keyword">in</span> response.content)</code></pre>
<pre><code>
<span class="comment">Run</span> <span class="comment">it</span>, <span class="comment">and</span> <span class="comment">you</span> <span class="comment">should</span> <span class="comment">see</span> <span class="comment">the</span> <span class="comment">test</span> <span class="comment">fail:</span>

<span class="comment">```</span> <span class="comment">bash</span>
<span class="comment">$</span> <span class="comment">python</span> <span class="comment">manage</span>.<span class="comment">py</span> <span class="comment">test</span> <span class="comment">blogengine</span>
<span class="comment">Creating</span> <span class="comment">test</span> <span class="comment">database</span> <span class="comment">for</span> <span class="comment">alias</span> <span class="comment">'default'</span>.<span class="string">.</span><span class="string">.</span>
<span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="comment">F</span>
<span class="comment">======================================================================</span>
<span class="comment">FAIL:</span> <span class="comment">test_sitemap</span> <span class="comment">(blogengine</span>.<span class="comment">tests</span>.<span class="comment">SitemapTest)</span>
<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>
<span class="comment">Traceback</span> <span class="comment">(most</span> <span class="comment">recent</span> <span class="comment">call</span> <span class="comment">last):</span>
  <span class="comment">File</span> <span class="comment">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests</span>.<span class="comment">py"</span>, <span class="comment">line</span> <span class="comment">847</span>, <span class="comment">in</span> <span class="comment">test_sitemap</span>
    <span class="comment">self</span>.<span class="comment">assertEquals(response</span>.<span class="comment">status_code</span>, <span class="comment">200)</span>
<span class="comment">AssertionError:</span> <span class="comment">404</span> <span class="comment">!=</span> <span class="comment">200</span>

<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>
<span class="comment">Ran</span> <span class="comment">28</span> <span class="comment">tests</span> <span class="comment">in</span> <span class="comment">6</span>.<span class="comment">873s</span>

<span class="comment">FAILED</span> <span class="comment">(failures=1)</span>
<span class="comment">Destroying</span> <span class="comment">test</span> <span class="comment">database</span> <span class="comment">for</span> <span class="comment">alias</span> <span class="comment">'default'</span>.<span class="string">.</span><span class="string">.</span></code></pre>
<p>Now, let&#39;s implement our sitemap. The sitemap application comes with Django, and needs to be activated in your settings file, under <code>INSTALLED_APPS</code>:</p>
<p>``` python django_blog_tutorial_ng/settings.py
    &#39;django.contrib.sitemaps&#39;,</p>
<pre><code>
Next, let's think <span class="keyword">about</span> what content we want <span class="keyword">to</span> include <span class="keyword">in</span> <span class="keyword">the</span> sitemap. We want <span class="keyword">to</span> index our flat pages <span class="keyword">and</span> our blog posts, so our sitemap should reflect <span class="keyword">that</span>. Create a new <span class="type">file</span> <span class="keyword">at</span> `blogengine/sitemap.py` <span class="keyword">and</span> enter <span class="keyword">the</span> following <span class="type">text</span>:

``` python blogengine/sitemap.py
<span class="keyword">from</span> django.contrib.sitemaps import Sitemap
<span class="keyword">from</span> django.contrib.flatpages.models import FlatPage
<span class="keyword">from</span> blogengine.models import Post

<span class="type">class</span> PostSitemap(Sitemap):
    changefreq = <span class="string">"always"</span>
    priority = <span class="number">0.5</span>

    def items(self):
<span class="command">        return</span> Post.objects.all()

    def lastmod(self, obj):
<span class="command">        return</span> obj.pub_date


<span class="type">class</span> FlatpageSitemap(Sitemap):
    changefreq = <span class="string">"always"</span>
    priority = <span class="number">0.5</span>

    def items(self):
<span class="command">        return</span> FlatPage.objects.all()</code></pre>
<p>We define two sitemaps, one for all the posts, and the other for all the flat pages. Note that this works in a very similar way to the syndication framework.</p>
<p>Next, we amend our URLs. Add the following text after the existing imports in your URL file:</p>
<p>``` python blogengine/urls.py
from django.contrib.sitemaps.views import sitemap
from blogengine.sitemap import PostSitemap, FlatpageSitemap</p>
<h1 id="define-sitemaps">Define sitemaps</h1>
<p>sitemaps = {
    &#39;posts&#39;: PostSitemap,
    &#39;pages&#39;: FlatpageSitemap
}</p>
<pre><code>
Then add the following after the existing routes:

``` python blogengine/urls.py
    <span class="comment"># Sitemap</span>
    url(<span class="string">r'^sitemap\.xml$'</span>, sitemap, {<span class="string">'sitemaps'</span>: sitemaps},
            name=<span class="string">'django.contrib.sitemaps.views.sitemap'</span>),</code></pre>
<p>Here we define what sitemaps we&#39;re going to use, and we define a URL for them. It&#39;s pretty straightforward to use.</p>
<p>Let&#39;s run our tests:</p>
<pre><code class="lang-bash">$ python manage.py test blogengine
Creating test database <span class="keyword">for</span> alias <span class="string">'default'</span>...
............................
----------------------------------------------------------------------
Ran 28 tests <span class="keyword">in</span> 6.863s

OK
Destroying test database <span class="keyword">for</span> alias <span class="string">'default'</span>...</code></pre>
<p>And done! Let&#39;s commit our changes:</p>
<pre><code class="lang-bash">git add blogengine/ django_tutorial_blog_ng/settings.py
git commit -m <span class="string">'Implemented a sitemap'</span></code></pre>
<h1 id="fixing-test-coverage">Fixing test coverage</h1>
<p>Our blog is now feature-complete, but there are a few gaps in test coverage, so we&#39;ll fix them. If, like me, you&#39;re using Coveralls.io, <a href="https://coveralls.io/builds/1151177">you can easily see via their web interface where there are gaps in the coverage</a>.</p>
<p>Now, our gaps are all in our view file - if you <a href="https://coveralls.io/files/280228813">take a look at my build</a>, you can easily identify the gaps as they&#39;re marked in red.</p>
<p>The first gap is where a tag does not exist. Interestingly, if we look at the code in the view, we can see that some of it is redundant:</p>
<p>``` python blogengine/views.py
class TagPostsFeed(PostsFeed):
    def get_object(self, request, slug):
        return get_object_or_404(Tag, slug=slug)</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">title</span><span class="params">(self, obj)</span>:</span>
    <span class="keyword">return</span> <span class="string">"RSS feed - blog posts tagged  %s"</span> % obj.name

<span class="function"><span class="keyword">def</span> <span class="title">link</span><span class="params">(self, obj)</span>:</span>
    <span class="keyword">return</span> obj.get_absolute_url()

<span class="function"><span class="keyword">def</span> <span class="title">description</span><span class="params">(self, obj)</span>:</span>
    <span class="keyword">return</span> <span class="string">"RSS feed - blog posts tagged %s"</span> % obj.name

<span class="function"><span class="keyword">def</span> <span class="title">items</span><span class="params">(self, obj)</span>:</span>
    <span class="keyword">try</span>:
        tag = Tag.objects.get(slug=obj.slug)
        <span class="keyword">return</span> tag.post_set.all()
    <span class="keyword">except</span> Tag.DoesNotExist:
        <span class="keyword">return</span> Post.objects.none()</code></pre>
<pre><code>
Under the `items` function, we check to see <span class="keyword">if</span> the tag exists. However, under `get_object` we can see that <span class="keyword">if</span> the <span class="class"><span class="keyword">object</span> <span class="title">didn</span>'<span class="title">t</span> <span class="title">exist</span>, <span class="title">it</span> <span class="title">would</span> <span class="title">already</span> <span class="title">have</span> <span class="title">returned</span> <span class="title">a</span> 404 <span class="title">error</span>. <span class="title">We</span> <span class="title">can</span> <span class="title">therefore</span> <span class="title">safely</span> <span class="title">amend</span> `<span class="title">items</span>` <span class="title">to</span> <span class="title">not</span> <span class="title">check</span>, <span class="title">since</span> <span class="title">that</span> <span class="title">try</span> <span class="title">statement</span> <span class="title">will</span> <span class="title">never</span> <span class="title">fail</span>:</span>

``` python blogengine/views.py
<span class="class"><span class="keyword">class</span> <span class="title">TagPostsFeed</span><span class="params">(PostsFeed)</span>:</span>
    <span class="keyword">def</span> get_object(self, request, slug):
        <span class="keyword">return</span> get_object_or_404(Tag, slug=slug)

    <span class="keyword">def</span> title(self, obj):
        <span class="keyword">return</span> <span class="string">"RSS feed - blog posts tagged  %s"</span> % obj.name

    <span class="keyword">def</span> link(self, obj):
        <span class="keyword">return</span> obj.get_absolute_url()

    <span class="keyword">def</span> description(self, obj):
        <span class="keyword">return</span> <span class="string">"RSS feed - blog posts tagged %s"</span> % obj.name

    <span class="keyword">def</span> items(self, obj):
        tag = Tag.objects.get(slug=obj.slug)
        <span class="keyword">return</span> tag.post_set.all()</code></pre>
<p>The other two gaps are in our search view - we never get an empty result for the search in the following section:</p>
<p>``` python blogengine/views.py
def getSearchResults(request):
    &quot;&quot;&quot;
    Search for a post by title or text
    &quot;&quot;&quot;</p>
<pre><code># <span class="keyword">Get</span> the query data
query = <span class="built_in">request</span>.<span class="keyword">GET</span>.<span class="keyword">get</span>(<span class="comment">'q', '')</span>
page = <span class="built_in">request</span>.<span class="keyword">GET</span>.<span class="keyword">get</span>(<span class="comment">'page', 1)</span>

# Query the database
<span class="keyword">if</span> query:
    results = Post.objects.<span class="built_in">filter</span>(Q(text__icontains=query) | Q(title__icontains=query))
<span class="keyword">else</span>:
    results = None

# Add pagination
pages = Paginator(results, <span class="number">5</span>)

# <span class="keyword">Get</span> specified page
try:
    returned_page = pages.page(page)
except EmptyPage:
    returned_page = pages.page(pages.num_pages)

# Display the search results
return render_to_response(<span class="comment">'blogengine/search_post_list.html',</span>
                          {<span class="comment">'page_obj': returned_page,</span>
                           <span class="comment">'object_list': returned_page.object_list,</span>
                           <span class="comment">'search': query})</span></code></pre>
<pre><code>
So replace it <span class="keyword">with</span> this:

``` python blogengine/views.py
<span class="function"><span class="keyword">def</span> <span class="title">getSearchResults</span><span class="params">(request)</span>:</span>
    <span class="string">"""
    Search for a post by title or text
    """</span>
    <span class="comment"># Get the query data</span>
    query = request.GET.get(<span class="string">'q'</span>, <span class="string">''</span>)
    page = request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>)

    <span class="comment"># Query the database</span>
    results = Post.objects.filter(Q(text__icontains=query) | Q(title__icontains=query))

    <span class="comment"># Add pagination</span>
    pages = Paginator(results, <span class="number">5</span>)

    <span class="comment"># Get specified page</span>
    <span class="keyword">try</span>:
        returned_page = pages.page(page)
    <span class="keyword">except</span> EmptyPage:
        returned_page = pages.page(pages.num_pages)

    <span class="comment"># Display the search results</span>
    <span class="keyword">return</span> render_to_response(<span class="string">'blogengine/search_post_list.html'</span>,
                              {<span class="string">'page_obj'</span>: returned_page,
                               <span class="string">'object_list'</span>: returned_page.object_list,
                               <span class="string">'search'</span>: query})</code></pre>
<p>We don&#39;t need to check whether <code>query</code> is defined because if <code>q</code> is left blank, the value of <code>query</code> will be an empty string, so we may as well pull out the redundant code.</p>
<p>Finally, the other gap is for when a user tries to get an empty search page (eg, page two of something with five or less results). So let&#39;s add another test to our <code>SearchViewTest</code> class:</p>
<p>``` python blogengine/tests.py
    def test_failing_search(self):</p>
<pre><code>    # Search <span class="keyword">for</span> something that <span class="keyword">is</span> <span class="keyword">not</span> present
    <span class="built_in">response</span> = self.client.<span class="keyword">get</span>(<span class="comment">'/search?q=wibble')</span>
    self.assertEquals(<span class="built_in">response</span>.status_code, <span class="number">200</span>)
    self.assertTrue(<span class="comment">'No posts found' in response.content)</span>

    # Try <span class="keyword">to</span> <span class="keyword">get</span> nonexistent <span class="built_in">second</span> page
    <span class="built_in">response</span> = self.client.<span class="keyword">get</span>(<span class="comment">'/search?q=wibble&amp;page=2')</span>
    self.assertEquals(<span class="built_in">response</span>.status_code, <span class="number">200</span>)
    self.assertTrue(<span class="comment">'No posts found' in response.content)</span></code></pre>
<pre><code>
<span class="comment">Run</span> <span class="comment">our</span> <span class="comment">tests</span> <span class="comment">and</span> <span class="comment">check</span> <span class="comment">the</span> <span class="comment">coverage:</span>

<span class="comment">```</span> <span class="comment">bash</span>
<span class="comment">coverage</span> <span class="comment">run</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">include="blogengine/*"</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">omit="blogengine/migrations/*"</span> <span class="comment">manage</span>.<span class="comment">py</span> <span class="comment">test</span> <span class="comment">blogengine</span>
<span class="comment">coverage</span> <span class="comment">html</code></pre>
<p>If you open <code>htmlcov/index.html</code> in your browser, you should see that the test coverage is back up to 100%. With that done, it&#39;s time to commit again:</p>
<pre><code class="lang-bash">git add blogengine/
git commit -m <span class="string">'Fixed gaps in coverage'</span></code></pre>
<p>Remember, it&#39;s not always possible to achieve 100% test coverage, and you shouldn&#39;t worry too much about it if it&#39;s not possible - <a href="http://nedbatchelder.com/code/coverage/excluding.html">it&#39;s possible to ignore code</a> if necessary. However, it&#39;s a good idea to aim for 100%.</p>
<h1 id="using-fabric-for-deployment">Using Fabric for deployment</h1>
<p>Next we&#39;ll cover using Fabric, a handy tool for deploying your changes (any pretty much any other task you want to automate). First, you need to install it:</p>
<pre><code class="lang-bash">pip install Fabric</code></pre>
<p>If you have any problems installing it, you should be able to resolve them via Google - most of them are likely to be absent libraries that Fabric depends upon. Once it&#39;s installed, add it to your <code>requirements.tzt</code>:</p>
<pre><code class="lang-bash">pip freeze &gt; requirements.txt</code></pre>
<p>Next, create a file called <code>fabfile.py</code> and enter the following text:</p>
<p>``` python fabfile.py</p>
<h1 id="-usr-bin-env-python">!/usr/bin/env python</h1>
<p>from fabric.api import local</p>
<p>def deploy():
    &quot;&quot;&quot;
    Deploy the latest version to Heroku
    &quot;&quot;&quot;</p>
<pre><code><span class="preprocessor"># Push changes to master</span>
local(<span class="string">"git push origin master"</span>)

<span class="preprocessor"># Push changes to Heroku</span>
local(<span class="string">"git push heroku master"</span>)

<span class="preprocessor"># Run migrations on Heroku</span>
local(<span class="string">"heroku run python manage.py migrate"</span>)</code></pre>
<pre><code>
Now, <span class="keyword">all</span> this <span class="keyword">file</span> does <span class="keyword">is</span> push our changes <span class="keyword">to</span> Github (<span class="keyword">or</span> wherever <span class="keyword">else</span> your repository <span class="keyword">is</span> hosted) <span class="keyword">and</span> <span class="keyword">to</span> Heroku, <span class="keyword">and</span> runs your migrations. It<span class="attribute">'s</span> <span class="keyword">not</span> a terribly big task anyway, but it<span class="attribute">'s</span> handy <span class="keyword">to</span> have it <span class="keyword">in</span> place. Let<span class="attribute">'s</span> commit our changes:

``` bash
git add fabfile.py requirements.txt
git commit -m <span class="attribute">'Added</span> Fabric task <span class="keyword">for</span> deployment'</code></pre>
<p>Then, let&#39;s try it out:</p>
<pre><code class="lang-bash">$ fab deploy</code></pre>
<p>There, wasn&#39;t that more convenient? Fabric is much more powerful than this simple demonstration indicates, and can run tasks on remote servers via SSH easily. I recommend you take a look at the <a href="http://www.fabfile.org/">documentation</a> to see what else you can do with it. If you&#39;re hosting your site on a VPS, you will probably find Fabric indispensable, as you will need to restart the application every time you push up a new revision.</p>
<h1 id="tidying-up">Tidying up</h1>
<p>We want our blog application to play nicely with other Django apps. For instance, say you&#39;re working on a new site that includes a blogging engine. Wouldn&#39;t it make sense to just be able to drop in this blogging engine and have it work immediately? At the moment, some of our URL&#39;s are hard-coded, so we may have problems in doing so. Let&#39;s fix that.</p>
<p>First we&#39;ll amend our tests. Add this at the top of the tests file:</p>
<p>``` python blogengine/tests.py
from django.core.urlresolvers import reverse</p>
<pre><code>
Next, replace every instance of <span class="keyword">this</span>:

``` python blogengine/tests<span class="variable">.py</span>
        response = <span class="keyword">self</span><span class="variable">.client</span><span class="variable">.get</span>(<span class="string">'/'</span>)</code></pre>
<p>with this:</p>
<p>``` python blogengine/tests.py
response = self.client.get(reverse(&#39;blogengine:index&#39;))</p>
<pre><code>
<span class="keyword">Then</span>, rewrite the calls <span class="keyword">to</span> the search route. <span class="keyword">For</span> instance, this:

``` python blogengine/tests.py
        <span class="built_in">response</span> = self.client.<span class="keyword">get</span>(<span class="comment">'/search?q=first')</span></code></pre>
<p>should become this:</p>
<p>``` python blogengine/tests.py
        response = self.client.get(reverse(&#39;blogengine:search&#39;) + &#39;?q=first&#39;)</p>
<pre><code>
I'll leave changing these <span class="keyword">as</span> an exercise <span class="keyword">for</span> <span class="keyword">the</span> reader, <span class="keyword">but</span> check <span class="keyword">the</span> repository <span class="keyword">if</span> you <span class="keyword">get</span> stuck.

Next, we need <span class="keyword">to</span> assign a namespace <span class="keyword">to</span> our app's routes:

``` python django_tutorial_blog_ng/urls.py
<span class="keyword">from</span> django.conf.urls import patterns, include, url

<span class="keyword">from</span> django.contrib import admin
admin.autodiscover()

urlpatterns = patterns('',
    <span class="comment"># Examples:</span>
    <span class="comment"># url(r'^$', 'django_tutorial_blog_ng.views.home', name='home'),</span>
    <span class="comment"># url(r'^blog/', include('blog.urls')),</span>

    url(r'^admin/', include(admin.site.urls)),

    <span class="comment"># Blog URLs</span>
    url(r'', include('blogengine.urls', namespace=<span class="string">"blogengine"</span>)),

    <span class="comment"># Flat pages</span>
    url(r'', include('django.contrib.flatpages.urls')),
)</code></pre>
<p>We then assign names to our routes in the app&#39;s <code>urls.py</code>:</p>
<p>``` python blogengine/urls.py
from django.conf.urls import patterns, url
from django.views.generic import ListView, DetailView
from blogengine.models import Post, Category, Tag
from blogengine.views import CategoryListView, TagListView, PostsFeed, CategoryPostsFeed, TagPostsFeed, getSearchResults
from django.contrib.sitemaps.views import sitemap
from blogengine.sitemap import PostSitemap, FlatpageSitemap</p>
<h1 id="define-sitemaps">Define sitemaps</h1>
<p>sitemaps = {
    &#39;posts&#39;: PostSitemap,
    &#39;pages&#39;: FlatpageSitemap
}</p>
<p>urlpatterns = patterns(&#39;&#39;,</p>
<pre><code><span class="comment"># Index</span>
url(<span class="string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
    model=Post,
    paginate_by=<span class="number">5</span>,
    ),
    name=<span class="string">'index'</span>
    ),

<span class="comment"># Individual posts</span>
url(<span class="string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
    model=Post,
    ),
    name=<span class="string">'post'</span>
    ),

<span class="comment"># Categories</span>
url(<span class="string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
    paginate_by=<span class="number">5</span>,
    model=Category,
    ),
    name=<span class="string">'category'</span>
    ),


<span class="comment"># Tags</span>
url(<span class="string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
    paginate_by=<span class="number">5</span>,
    model=Tag,
    ),
    name=<span class="string">'tag'</span>
    ),

<span class="comment"># Post RSS feed</span>
url(<span class="string">r'^feeds/posts/$'</span>, PostsFeed()),

<span class="comment"># Category RSS feed</span>
url(<span class="string">r'^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryPostsFeed()),

<span class="comment"># Tag RSS feed</span>
url(<span class="string">r'^feeds/posts/tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagPostsFeed()),

<span class="comment"># Search posts</span>
url(<span class="string">r'^search'</span>, getSearchResults, name=<span class="string">'search'</span>),

<span class="comment"># Sitemap</span>
url(<span class="string">r'^sitemap\.xml$'</span>, sitemap, {<span class="string">'sitemaps'</span>: sitemaps},
        name=<span class="string">'django.contrib.sitemaps.views.sitemap'</span>),</code></pre>
<p>)</p>
<pre><code>
You also need to amend two of your templates:

``` html blogengine/templates/blogengine/includes/base.html
<span class="template_tag">{% raw %}</span><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="comment">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="comment">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="comment">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="comment">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="tag">&lt;<span class="title">html</span> <span class="attribute">class</span>=<span class="value">"no-js"</span>&gt;</span> <span class="comment">&lt;!--&lt;![endif]--&gt;</span>
    <span class="tag">&lt;<span class="title">head</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"X-UA-Compatible"</span> <span class="attribute">content</span>=<span class="value">"IE=edge"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">title</span>&gt;</span><span class="template_tag">{% <span class="keyword">block</span> title %}</span>My Django Blog<span class="template_tag">{% <span class="keyword">endblock</span> %}</span><span class="tag">&lt;/<span class="title">title</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"description"</span> <span class="attribute">content</span>=<span class="value">""</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"alternate"</span> <span class="attribute">type</span>=<span class="value">"application/rss+xml"</span> <span class="attribute">title</span>=<span class="value">"Blog posts"</span> <span class="attribute">href</span>=<span class="value">"/feeds/posts/"</span> &gt;</span>

        <span class="comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>

        <span class="template_tag">{% <span class="keyword">load</span> staticfiles %}</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/html5-boilerplate/css/normalize.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/html5-boilerplate/css/main.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'css/main.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'css/code.css' %}</span>"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}</span>"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">body</span>&gt;</span>
        <span class="comment">&lt;!--[if lt IE 7]&gt;
            &lt;p class="browsehappy"&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;
        &lt;![endif]--&gt;</span>

        <span class="comment">&lt;!-- Add your site or application content here --&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"fb-root"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">(<span class="keyword">function</span>(d, s, id) {
            <span class="keyword">var</span> js, fjs = d.getElementsByTagName(s)[<span class="number">0</span>];
            <span class="keyword">if</span> (d.getElementById(id)) <span class="keyword">return</span>;
                js = d.createElement(s); js.id = id;
                js.src = <span class="string">"//connect.facebook.net/en_GB/all.js#xfbml=1"</span>;
                fjs.parentNode.insertBefore(js, fjs);
            }(document, <span class="string">'script'</span>, <span class="string">'facebook-jssdk'</span>));</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container-fluid"</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar-header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">class</span>=<span class="value">"navbar-toggle"</span> <span class="attribute">data-toggle</span>=<span class="value">"collapse"</span> <span class="attribute">data-target</span>=<span class="value">"#header-nav"</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                    <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"navbar-brand"</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">url</span> 'blogengine:index' %}</span>"</span>&gt;</span>My Django Blog<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"collapse navbar-collapse"</span> <span class="attribute">id</span>=<span class="value">"header-nav"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">"nav navbar-nav"</span>&gt;</span>
                        <span class="template_tag">{% <span class="keyword">load</span> flatpages %}</span>
                        <span class="template_tag">{% get_flatpages <span class="keyword">as</span> flatpages %}</span>
                        <span class="template_tag">{% <span class="keyword">for</span> flatpage <span class="keyword">in</span> flatpages %}</span>
                        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="variable">{{ flatpage.url }}</span>"</span>&gt;</span><span class="variable">{{ flatpage.title }}</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
                        <span class="template_tag">{% <span class="keyword">endfor</span> %}</span>
                        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>

                        <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/search"</span> <span class="attribute">method</span>=<span class="value">"GET"</span> <span class="attribute">class</span>=<span class="value">"navbar-form navbar-left"</span>&gt;</span>
                            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>
                                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"q"</span> <span class="attribute">placeholder</span>=<span class="value">"Search..."</span> <span class="attribute">class</span>=<span class="value">"form-control"</span>&gt;</span><span class="tag">&lt;/<span class="title">input</span>&gt;</span>
                            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                            <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">class</span>=<span class="value">"btn btn-default"</span>&gt;</span>Search<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
                        <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
                    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container"</span>&gt;</span>
            <span class="template_tag">{% <span class="keyword">block</span> header %}</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"page-header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">h1</span>&gt;</span>My Django Blog<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            <span class="template_tag">{% <span class="keyword">endblock</span> %}</span>

            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span>
                <span class="template_tag">{% <span class="keyword">block</span> content %}</span><span class="template_tag">{% <span class="keyword">endblock</span> %}</span>
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container footer"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"span12"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">p</span>&gt;</span>Copyright &amp;copy; <span class="template_tag">{% <span class="keyword">now</span> "Y" %}</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">window.jQuery || document.write(<span class="string">'&lt;script src="{% static '</span>bower_components/html5-boilerplate/js/vendor/jquery-<span class="number">1.10</span><span class="number">.2</span>.min.js<span class="string">' %}"&gt;&lt;\/script&gt;'</span>)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/html5-boilerplate/js/plugins.js' %}</span>"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">static</span> 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}</span>"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

        <span class="comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
            (<span class="keyword">function</span>(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            <span class="keyword">function</span>(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+<span class="keyword">new</span> Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[<span class="number">0</span>];
            e.src=<span class="string">'//www.google-analytics.com/analytics.js'</span>;
            r.parentNode.insertBefore(e,r)}(window,document,<span class="string">'script'</span>,<span class="string">'ga'</span>));
            ga(<span class="string">'create'</span>,<span class="string">'UA-XXXXX-X'</span>);ga(<span class="string">'send'</span>,<span class="string">'pageview'</span>);
        </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span><span class="template_tag">{% endraw %}</span></code></pre>
<p>``` html blogengine/templates/blogengine/search_post_list.html
{% raw %}{% extends &quot;blogengine/includes/base.html&quot; %}</p>
<pre><code><span class="template_tag">{% <span class="keyword">load</span> custom_markdown %}</span>

<span class="template_tag">{% <span class="keyword">block</span> content %}</span>
    <span class="template_tag">{% <span class="keyword">if</span> object_list %}</span>
        <span class="template_tag">{% <span class="keyword">for</span> post <span class="keyword">in</span> object_list %}</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"post col-md-12"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="variable">{{ post.get_absolute_url }}</span>"</span>&gt;</span><span class="variable">{{ post.title }}</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
        <span class="tag">&lt;<span class="title">h3</span>&gt;</span><span class="variable">{{ post.pub_date }}</span><span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
        <span class="variable">{{ post.text<span class="filter">|custom</span>_markdown }}</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="template_tag">{% <span class="keyword">if</span> post.category %}</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"col-md-12"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="variable">{{ post.category.get_absolute_url }}</span>"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"label label-primary"</span>&gt;</span><span class="variable">{{ post.category.name }}</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="template_tag">{% <span class="keyword">endif</span> %}</span>
        <span class="template_tag">{% <span class="keyword">if</span> post.tags %}</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"col-md-12"</span>&gt;</span>
        <span class="template_tag">{% <span class="keyword">for</span> tag <span class="keyword">in</span> post.tags.all %}</span>
        <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="variable">{{ tag.get_absolute_url }}</span>"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"label label-success"</span>&gt;</span><span class="variable">{{ tag.name }}</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span>
        <span class="template_tag">{% <span class="keyword">endfor</span> %}</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="template_tag">{% <span class="keyword">endif</span> %}</span>
        <span class="template_tag">{% <span class="keyword">endfor</span> %}</span>
    <span class="template_tag">{% <span class="keyword">else</span> %}</span>
        <span class="tag">&lt;<span class="title">p</span>&gt;</span>No posts found<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
    <span class="template_tag">{% <span class="keyword">endif</span> %}</span>

    <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">"pager"</span>&gt;</span>
    <span class="template_tag">{% <span class="keyword">if</span> page_obj.has_previous %}</span>
    <span class="tag">&lt;<span class="title">li</span> <span class="attribute">class</span>=<span class="value">"previous"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">url</span> 'blogengine:search' %}</span>?page=<span class="variable">{{ page_obj.previous_page_number }}</span>&amp;q=<span class="variable">{{ search }}</span>"</span>&gt;</span>Previous Page<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="template_tag">{% <span class="keyword">endif</span> %}</span>
    <span class="template_tag">{% <span class="keyword">if</span> page_obj.has_next %}</span>
    <span class="tag">&lt;<span class="title">li</span> <span class="attribute">class</span>=<span class="value">"next"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"<span class="template_tag">{% <span class="keyword">url</span> 'blogengine:search' %}</span>?page=<span class="variable">{{ page_obj.next_page_number }}</span>&amp;q=<span class="variable">{{ search }}</span>"</span>&gt;</span>Next Page<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="template_tag">{% <span class="keyword">endif</span> %}</span>
    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>

<span class="template_tag">{% <span class="keyword">endblock</span> %}</span><span class="template_tag">{% endraw %}</span></code></pre>
<pre><code>
<span class="comment">Let's</span> <span class="comment">run</span> <span class="comment">our</span> <span class="comment">tests:</span>

<span class="comment">```</span> <span class="comment">bash</span>
<span class="comment">$</span> <span class="comment">python</span> <span class="comment">manage</span>.<span class="comment">py</span> <span class="comment">test</span> <span class="comment">blogengine/</span>
<span class="comment">Creating</span> <span class="comment">test</span> <span class="comment">database</span> <span class="comment">for</span> <span class="comment">alias</span> <span class="comment">'default'</span>.<span class="string">.</span><span class="string">.</span>
<span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>
<span class="comment">Ran</span> <span class="comment">29</span> <span class="comment">tests</span> <span class="comment">in</span> <span class="comment">10</span>.<span class="comment">456s</span>

<span class="comment">OK</span>
<span class="comment">Destroying</span> <span class="comment">test</span> <span class="comment">database</span> <span class="comment">for</span> <span class="comment">alias</span> <span class="comment">'default'</span>.<span class="string">.</span><span class="string">.</span></code></pre>
<p>And commit our changes:</p>
<pre><code class="lang-bash">git add .
git commit -m <span class="string">'Now use named routes'</span></code></pre>
<h1 id="debugging-django">Debugging Django</h1>
<p>There are a number of handy ways to debug Django applications. One of the simplest is to use the Python debugger. To use it, just enter the following lines at the point you want to break at:</p>
<pre><code class="lang-python"><span class="keyword">import</span> pdb
pdb.set_trace()</code></pre>
<p>Now, whenever that line of code is run, you&#39;ll be dropped into an interactive shell that lets you play around to find out what&#39;s going wrong. However, it doesn&#39;t offer autocompletion, so we&#39;ll install <code>ipdb</code>, which is an improved version:</p>
<pre><code class="lang-bash">pip install ipdb
pip freeze &gt; requirements.txt</code></pre>
<p>Now you can use <code>ipdb</code> in much the same way as you would use <code>pdb</code>:</p>
<pre><code class="lang-python"><span class="keyword">import</span> ipdb
ipdb.set_trace()</code></pre>
<p>Now, <code>ipdb</code> is very useful, but it isn&#39;t much help for profiling your application. For that you need the Django Debug Toolbar. Run the following commands:</p>
<pre><code class="lang-bash">pip install django-debug-toolbar
pip freeze &gt; requirements.txt</code></pre>
<p>Then add the following line to <code>INSTALLED_APPS</code> in your settings file:</p>
<p>``` python django_blog_tutorial_ng/settings.py
    &#39;debug_toolbar&#39;,</p>
<pre><code>
Then, <span class="keyword">try</span> <span class="property">running</span> <span class="keyword">the</span> development server, <span class="keyword">and</span> you'll see a toolbar <span class="function_start"><span class="keyword">on</span> <span class="title">the</span></span> right-hand side <span class="keyword">of</span> <span class="keyword">the</span> screen <span class="keyword">that</span> allows you <span class="keyword">to</span> view <span class="keyword">some</span> useful data <span class="keyword">about</span> your page. For instance, you'll notice a field called `SQL` - this <span class="keyword">contains</span> details <span class="keyword">of</span> <span class="keyword">the</span> queries carried out when building <span class="keyword">the</span> page. To actually see <span class="keyword">the</span> queries carried out, you'll want <span class="keyword">to</span> disable caching <span class="keyword">in</span> your settings <span class="type">file</span> <span class="keyword">by</span> commenting out all <span class="keyword">the</span> constants <span class="keyword">that</span> <span class="keyword">start with</span> `CACHE`.

We won't go <span class="keyword">into</span> using <span class="keyword">the</span> toolbar <span class="keyword">to</span> optimise queries, <span class="keyword">but</span> using this, you can easily see what queries are being executed <span class="function_start"><span class="keyword">on</span> <span class="title">a</span></span> specific page, how long they take, <span class="keyword">and</span> <span class="keyword">the</span> values they <span class="constant">return</span>. Sometimes, you may need <span class="keyword">to</span> optimise a slow query - <span class="keyword">in</span> this case, Django allows you <span class="keyword">to</span> drop down <span class="keyword">to</span> writing raw SQL <span class="keyword">if</span> necessary.

Note <span class="keyword">that</span> <span class="keyword">if</span> you're <span class="property">running</span> Django <span class="keyword">in</span> production, you should <span class="keyword">set</span> `DEBUG` <span class="keyword">to</span> `False` <span class="keyword">as</span> otherwise <span class="keyword">it</span> gives rather too much information <span class="keyword">to</span> potential attackers, <span class="keyword">and</span> <span class="keyword">with</span> Django Debug Toolbar installed, <span class="keyword">that</span>'s even more important.

Please also note <span class="keyword">that</span> when you disable debug mode, Django no longer handles static files automatically, so you'll need <span class="keyword">to</span> <span class="command">run</span> `python manage.py collectstatic` <span class="keyword">and</span> commit <span class="keyword">the</span> `staticfiles` directory.

Once you've disabled debug mode, collected <span class="keyword">the</span> static files, <span class="keyword">and</span> re-enables caching, you can commit your changes:

``` bash
git add .
git commit -m 'Installed debugging tools'</code></pre>
<h1 id="optimising-static-files">Optimising static files</h1>
<p>We want our blog to get the best SEO results it can, so making it fast is essential. One of the simplest things you can do is to concatenate and minify static assets such as CSS and JavaScript. There are numerous ways to do this, but I generally use Grunt. Let&#39;s set up a Grunt config to concatenate and minify our CSS and JavaScript.</p>
<p>You&#39;ll need to have Node.js installed on your development machine for this. Then, you need to install the Grunt command-line interface:</p>
<pre><code class="lang-bash">sudo npm install -g grunt-cli</code></pre>
<p>With that done, we need to create a <code>package.json</code> file. You can create one using the command <code>npm init</code>. Here&#39;s mine:</p>
<p>``` json package.json
{
  &quot;name&quot;: &quot;django_tutorial_blog_ng&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;Django Tutorial Blog NG =======================&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;repository&quot;: {
    &quot;type&quot;: &quot;git&quot;,
    &quot;url&quot;: &quot;<a href="https://github.com/matthewbdaly/django_tutorial_blog_ng.git">https://github.com/matthewbdaly/django_tutorial_blog_ng.git</a>&quot;
  },
  &quot;author&quot;: &quot;Matthew Daly <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#x3a;&#x6d;&#x61;&#116;&#x74;&#x68;&#101;&#119;&#x40;&#x6d;&#x61;&#116;&#116;&#x68;&#x65;&#119;&#100;&#97;&#x6c;&#121;&#46;&#x63;&#111;&#46;&#x75;&#x6b;">&#x6d;&#x61;&#116;&#x74;&#x68;&#101;&#119;&#x40;&#x6d;&#x61;&#116;&#116;&#x68;&#x65;&#119;&#100;&#97;&#x6c;&#121;&#46;&#x63;&#111;&#46;&#x75;&#x6b;</a> (<a href="http://matthewdaly.co.uk/">http://matthewdaly.co.uk/</a>)&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;bugs&quot;: {
    &quot;url&quot;: &quot;<a href="https://github.com/matthewbdaly/django_tutorial_blog_ng/issues">https://github.com/matthewbdaly/django_tutorial_blog_ng/issues</a>&quot;
  },
  &quot;homepage&quot;: &quot;<a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">https://github.com/matthewbdaly/django_tutorial_blog_ng</a>&quot;
}</p>
<pre><code>
Feel free <span class="keyword">to</span> amend  <span class="keyword">it</span> <span class="keyword">as</span> you see fit.

Next we install Grunt <span class="keyword">and</span> <span class="keyword">the</span> required plugins:

``` bash
npm install grunt grunt-contrib-cssmin grunt-contrib-concat grunt-contrib-uglify <span class="comment">--save-dev</span></code></pre>
<p>We now need to create a Gruntfile for our tasks:</p>
<p>``` javascript Gruntfile.js
module.exports = function (grunt) {
    &#39;use strict&#39;;</p>
<pre><code>grunt.initConfig({
    concat: {
        dist: {
            src: [
                <span class="comment">'blogengine/static/bower_components/bootstrap/dist/css/bootstrap.css',</span>
                <span class="comment">'blogengine/static/bower_components/bootstrap/dist/css/bootstrap-theme.css',</span>
                <span class="comment">'blogengine/static/css/code.css',</span>
                <span class="comment">'blogengine/static/css/main.css',</span>
            ],
            dest: <span class="comment">'blogengine/static/css/style.css'</span>
        }
    },
    uglify: {
        dist: {
            src: [
                <span class="comment">'blogengine/static/bower_components/jquery/jquery.js',</span>
                <span class="comment">'blogengine/static/bower_components/bootstrap/dist/js/bootstrap.js'</span>
            ],
            dest: <span class="comment">'blogengine/static/js/all.min.js'</span>
        }
    },
    cssmin: {
        dist: {
            src: <span class="comment">'blogengine/static/css/style.css',</span>
            dest: <span class="comment">'blogengine/static/css/style.min.css'</span>
        }
    }
});

grunt.loadNpmTasks(<span class="comment">'grunt-contrib-concat');</span>
grunt.loadNpmTasks(<span class="comment">'grunt-contrib-uglify');</span>
grunt.loadNpmTasks(<span class="comment">'grunt-contrib-cssmin');</span>
grunt.registerTask(<span class="comment">'default', ['concat', 'uglify', 'cssmin']);</span></code></pre>
<p>};</p>
<pre><code><span class="xml">
You'll also need to change the paths in your base HTML file to point to the minified versions:

``` html blogengine/templates/blogengine/includes/base.html
{% raw %}<span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="comment">&lt;!--[if lt IE </span><span class="number">7</span><span class="xml">]&gt;      <span class="tag">&lt;<span class="title">html</span> <span class="attribute">class</span>=<span class="value">"no-js lt-ie9 lt-ie8 lt-ie7"</span>&gt;</span> <span class="tag">&lt;<span class="title">![endif]--</span>&gt;</span>
<span class="comment">&lt;!--[if IE </span><span class="number">7</span><span class="xml">]&gt;         <span class="tag">&lt;<span class="title">html</span> <span class="attribute">class</span>=<span class="value">"no-js lt-ie9 lt-ie8"</span>&gt;</span> <span class="tag">&lt;<span class="title">![endif]--</span>&gt;</span>
<span class="comment">&lt;!--[if IE </span><span class="number">8</span><span class="xml">]&gt;         <span class="tag">&lt;<span class="title">html</span> <span class="attribute">class</span>=<span class="value">"no-js lt-ie9"</span>&gt;</span> <span class="tag">&lt;<span class="title">![endif]--</span>&gt;</span>
<span class="comment">&lt;!--[if gt IE </span><span class="number">8</span><span class="xml">]&gt;<span class="comment">&lt;!--&gt; &lt;html class="no-js"&gt; &lt;!--&lt;![endif]--&gt;</span>
    <span class="tag">&lt;<span class="title">head</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-</span><span class="number">8</span><span class="xml">"&gt;
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"X-UA-Compatible"</span> <span class="attribute">content</span>=<span class="value">"IE=edge"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">title</span>&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"description"</span> <span class="attribute">content</span>=<span class="value">""</span>&gt;</span>
        <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=</span><span class="number">1</span><span class="xml">"&gt;
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"alternate"</span> <span class="attribute">type</span>=<span class="value">"application/rss+xml"</span> <span class="attribute">title</span>=<span class="value">"Blog posts"</span> <span class="attribute">href</span>=<span class="value">"/feeds/posts/"</span> &gt;</span>

        <span class="comment">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>

        {% load staticfiles %}
        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"{% static 'css/style.min.css' %}"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">body</span>&gt;</span>
        <span class="comment">&lt;!--[if lt IE </span><span class="number">7</span><span class="xml">]&gt;
            <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"browsehappy"</span>&gt;</span>You are using an <span class="tag">&lt;<span class="title">strong</span>&gt;</span>outdated<span class="tag">&lt;/<span class="title">strong</span>&gt;</span> browser. Please <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://browsehappy.com/"</span>&gt;</span>upgrade your browser<span class="tag">&lt;/<span class="title">a</span>&gt;</span> to improve your experience.<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
        <span class="tag">&lt;<span class="title">![endif]--</span>&gt;</span>

        <span class="comment">&lt;!-- Add your site or application content here --&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"fb-root"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">(<span class="keyword">function</span>(d, s, id) {
            <span class="keyword">var</span> js, fjs = d.getElementsByTagName(s)[</span></span><span class="number">0</span><span class="xml">];
            if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_GB/all.js#xfbml=</span><span class="number">1</span><span class="xml">";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));<span class="tag">&lt;/<span class="title">script</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar navbar-static-top navbar-inverse"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container-fluid"</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"navbar-header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">class</span>=<span class="value">"navbar-toggle"</span> <span class="attribute">data-toggle</span>=<span class="value">"collapse"</span> <span class="attribute">data-target</span>=<span class="value">"#header-nav"</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
                    <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"navbar-brand"</span> <span class="attribute">href</span>=<span class="value">"{% url 'blogengine:index' %}"</span>&gt;</span>My Django Blog<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"collapse navbar-collapse"</span> <span class="attribute">id</span>=<span class="value">"header-nav"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">"nav navbar-nav"</span>&gt;</span>
                        {% load flatpages %}
                        {% get_flatpages as flatpages %}
                        {% for flatpage in flatpages %}
                        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"{{ flatpage.url }}"</span>&gt;</span>{{ flatpage.title }}<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
                        {% endfor %}
                        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/feeds/posts/"</span>&gt;</span>RSS feed<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>

                        <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/search"</span> <span class="attribute">method</span>=<span class="value">"GET"</span> <span class="attribute">class</span>=<span class="value">"navbar-form navbar-left"</span>&gt;</span>
                            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>
                                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"q"</span> <span class="attribute">placeholder</span>=<span class="value">"Search..."</span> <span class="attribute">class</span>=<span class="value">"form-control"</span>&gt;</span><span class="tag">&lt;/<span class="title">input</span>&gt;</span>
                            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                            <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">class</span>=<span class="value">"btn btn-default"</span>&gt;</span>Search<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
                        <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
                    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container"</span>&gt;</span>
            {% block header %}
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"page-header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">h1</span>&gt;</span>My Django Blog<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            {% endblock %}

            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span>
                {% block content %}{% endblock %}
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container footer"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span>
                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"span12"</span>&gt;</span>
                    <span class="tag">&lt;<span class="title">p</span>&gt;</span>Copyright &amp;copy; {% now "Y" %}<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
                <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"{% static 'js/all.min.js' %}"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

        <span class="comment">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --&gt;</span>
        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
            (<span class="keyword">function</span>(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            <span class="keyword">function</span>(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+<span class="keyword">new</span> Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[</span></span><span class="number">0</span><span class="xml">];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        <span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>{% endraw %}</span></code></pre>
<p>Now, run the Grunt task:</p>
<pre><code class="lang-bash">grunt</code></pre>
<p>And collect the static files:</p>
<pre><code class="lang-bash">python manage.py collectstatic</code></pre>
<p>You&#39;ll also want to add your <code>node_modules</code> folder to your <code>gitignore</code>:</p>
<p>``` bash .gitignore
venv/
*.pyc
db.sqlite3
reports/
htmlcov/
.coverage
node_modules/</p>
<pre><code>
Then <span class="operator"><span class="keyword">commit</span> your changes:

<span class="string">``</span><span class="string">` bash
git add .
git commit -m 'Optimised static assets'</code></pre>
<p>Now, our <code>package.json</code> will cause a problem - it will mean that this app is mistakenly identified as a Node.js app. To prevent this, create the following file:</p>
<p>``` bash .slugignore
package.json</p>
<pre><code>
Then <span class="operator"><span class="keyword">commit</span> your changes <span class="keyword">and</span> push them up:

<span class="string">``</span><span class="string">` bash
git add .slugignore
git commit -m 'Added slugignore'
fab deploy</code></pre>
<p>If you check, your site should now be loading the minified versions of the static files.</p>
<p>That&#39;s our site done! As usual I&#39;ve tagged the final commit with <code>lesson-8</code>.</p>
<p>Sadly, that&#39;s our final instalment over with! I hope you&#39;ve enjoyed these tutorials, and I look forward to seeing what you create with them.</p>

  </section>
    <section>
        <p>
          31st August 2014
          
            by Matthew Daly
          
        </p>
    </section>

  <ul class="pager">
      
        <li><a href="/posts/2014-09-28-changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim.html">Newer</a></li>
      
      
        <li><a href="/posts/2014-08-25-django-blog-tutorial-the-next-generation-part-7.html">Older</a></li>
      
    </ul>
  <section class="comments">
    
    
        <div class="fb-comments" data-href="http://matthewbdaly.getforge.io/posts/2014-08-31-django-blog-tutorial-the-next-generation-part-8.html" data-width="470" data-num-posts="10"></div>
        </div>
    
  </section>
</article>

        </div>

        <footer>
            <div class="container">
                Copyright Matthew Daly, 2014.
            </div>
        </footer>
        <script type="text/javascript" src="/static/js/dependencies.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
